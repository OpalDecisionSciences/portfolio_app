{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Michelin Star Service</title>
	<!-- Google Font Family Link Start -->
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Montserrat:400,700">
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,800">
	<!-- Google Font Family Link End -->

	<!-- CSS -->
	<link href="{% static 'css/iconmoon.css' %}" rel="stylesheet">
	<link href="{% static 'css/style.css' %}" rel="stylesheet">
	<link href="{% static 'css/cs-foodbakery-plugin.css' %}" rel="stylesheet">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
	<link href="{% static 'css/bootstrap-slider.css' %}" rel="stylesheet">
	
	<!-- JAVASCRIPT -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script src="{% static 'js/modernizr.js' %}"></script>
	<script src="{% static 'js/bootstrap.js' %}"></script>

	<style>
		body, .main-section p, .mce-content-body p{
			font:Normal  14px/24px "Open Sans", sans-serif;letter-spacing: 0px;text-transform: none;color: #515151 !important;
		}
		
		.star-placeholder {
			width: 100%;
			height: 200px;
			background: linear-gradient(45deg, #e74c3c, #c0392b);
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			color: white;
			font-size: 48px;
			border-radius: 8px;
			text-align: center;
		}
		
		.star-placeholder::after {
			content: "Images coming soon!";
			font-size: 14px;
			margin-top: 10px;
			opacity: 0.9;
		}
		
		/* Search bar customization */
		.main-search .field-holder input[type="text"] {
			border: 2px solid #f39c12 !important;
			border-radius: 5px;
		}
		
		.main-search .field-holder input[type="text"]:focus {
			border-color: #f1c40f !important;
			box-shadow: 0 0 5px rgba(241, 196, 64, 0.3) !important;
		}
		
		.main-search input[type="submit"] {
			background: #e74c3c !important;
			border: 2px solid #e74c3c !important;
			color: white !important;
		}
		
		.main-search input[type="submit"]:hover {
			background: #c0392b !important;
			border-color: #c0392b !important;
		}
		
		#use-location-btn {
			background: transparent !important;
			border: 2px solid #e74c3c !important;
			color: #e74c3c !important;
		}
		
		#use-location-btn:hover {
			background: #e74c3c !important;
			color: white !important;
		}
		
		.suggestion-image, .recommendation-image {
			width: 100%;
			height: 150px;
			object-fit: cover;
			border-radius: 8px;
		}
		
		.star-placeholder-small {
			width: 100%;
			height: 150px;
			background: linear-gradient(45deg, #e74c3c, #c0392b);
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			color: white;
			font-size: 32px;
			border-radius: 8px;
			text-align: center;
		}
		
		.star-placeholder-small::after {
			content: "Images coming soon!";
			font-size: 12px;
			margin-top: 8px;
			opacity: 0.9;
		}
		
		/* Home Page Image Carousel Styles */
		.home-image-carousel {
			position: relative;
			width: 100%;
			height: 200px;
			overflow: hidden;
			border-radius: 8px 8px 0 0;
		}
		
		.home-carousel-track {
			display: flex;
			width: 100%;
			height: 100%;
			transition: transform 0.3s ease;
		}
		
		.home-carousel-track img {
			width: 100%;
			height: 100%;
			object-fit: cover;
			flex-shrink: 0;
		}
		
		.home-carousel-nav {
			position: absolute;
			bottom: 8px;
			left: 50%;
			transform: translateX(-50%);
			display: flex;
			gap: 4px;
			z-index: 10;
		}
		
		.home-carousel-dot {
			width: 6px;
			height: 6px;
			border-radius: 50%;
			background: rgba(255,255,255,0.5);
			cursor: pointer;
			transition: background 0.3s ease;
		}
		
		.home-carousel-dot.active {
			background: white;
		}
		
		.home-carousel-controls {
			position: absolute;
			top: 50%;
			transform: translateY(-50%);
			background: rgba(0,0,0,0.5);
			color: white;
			border: none;
			width: 24px;
			height: 24px;
			border-radius: 50%;
			cursor: pointer;
			display: none;
			align-items: center;
			justify-content: center;
			font-size: 12px;
			z-index: 10;
		}
		
		.home-carousel-controls.prev {
			left: 8px;
		}
		
		.home-carousel-controls.next {
			right: 8px;
		}
		
		.home-image-carousel:hover .home-carousel-controls {
			display: flex;
		}
		
		.michelin-star-badge {
			position: absolute;
			top: 10px;
			right: 10px;
			background: rgba(0,0,0,0.7);
			color: white;
			padding: 5px 10px;
			border-radius: 15px;
			font-size: 12px;
			z-index: 10;
		}
		
		.customer-rating {
			color: #f39c12;
		}
		
		.michelin-stars {
			color: #e74c3c;
		}
	</style>
</head>

<body>
	<!--Main Wrapper-->
	<div class="wrapper">
		<!-- Header Start -->
		<header id="header">
			<div class="main-header">
				<div class="container">
					<div class="row">
						<div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
							<div class="logo">
								<figure>
									<a href="index.html" class="light-logo">
										<div style="display: flex; align-items: center; font-size: 24px; color: #e74c3c;">
											<i class="icon-star-full" style="font-size: 32px; margin-right: 10px;"></i>
											<span style="font-weight: bold;">Michelin Star Service</span>
										</div>
									</a>
								</figure>
							</div>
							<div class="main-nav">
									<nav id="site-navigation" class="main-navigation">
										<ul>
											<li><a href="{% url 'home' %}">Home</a></li>
											<li><a href="{% url 'restaurants:restaurant_list' %}">Restaurants</a></li>
											<li><a href="{% url 'restaurants:gallery' %}">Gallery</a></li>
											<li>
												<a href="#">Pages</a>
												<ul>
													<li><a href="price-plans.html">Price Plans</a></li>
													<li><a href="how-it-works.html">How it works</a></li>
													<li><a href="faq.html">FAQ's</a></li>
													<li><a href="404.html">404</a></li>
													<li><a href="search-result.html">Search Result</a></li>
													<li><a href="contact-us.html">Contact</a></li>
												</ul>
												<!--End Sub Menu -->
											</li>
											<li>
												<a href="#">Blogs</a>
												<ul>
													<li><a href="blog-large.html">Blog Large</a></li>
													<li><a href="blog-medium.html">Blog Medium</a></li>
													<li><a href="blog-masonry.html">Blog Masonry</a></li>
													<li><a href="blog-detail.html">Blog Detail Page</a></li>
												</ul>
												<!--End Sub Menu -->
											</li>
										</ul>
									</nav><!-- .main-navigation -->
								</div>
							
							<div class="main-location">
								<ul>
									<li class="location-has-children choose-location">
										<form action="#" id="location-search-form">
											<input type="text" value="" name="location" id="location-input" placeholder="Enter your location for nearby restaurants" autocomplete="off">
											<span id="get-location-btn" class="foodbakery-radius-location" title="Use my current location"><i class="icon-target5"></i></span>
										</form>
									</li>
								</ul>
								</div>
						</div>
						<div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
							<div class="login-option">
								<a class="cs-color cs-popup-joinus-btn login-popup" data-target="#sign-in" data-toggle="modal" href="#user-register">Login / Register</a><a class="get-start-btn" href="register-restaurant.html">
									Register
									Restaurant </a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</header>
		<!-- Header End -->
		<!-- Main Section Start -->
		<div class="main-section">
			<!-- Home Pages Elements Strat -->
			<!-- Main Search Start -->
			<div class="page-section nopadding cs-nomargin" style="padding-top: 200px; padding-bottom: 150px; margin-bottom: 0px; background: url(assets/extra-images/bg-image1.jpg) no-repeat center / cover;">
				<div class="container">
					<div class="row">
						<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 ">
							<div class="element-title">
								<h1 style="font-size: 40px; color: #505050; text-transform: uppercase; line-height: 50px; margin-bottom: 25px; text-align:center;">
									Experience Michelin-Starred Tech: Crafted Like Cuisine, Engineered Like Excellence</h1>
                                <h3 style="font-size: 24px; color: #505050; line-height: 35px; margin-bottom: 25px; text-align:center;">  
                                    üåç Explore 15,000+ Global Fine Dining Destinations ‚Ä¢ ü§ñ Intelligent, Taste-Aware Recommendations ‚Ä¢ üïê Seamlessly Tuned to Global, Locale-Sensitive Insights Across Timezones</h3>
								<div style="text-align: center; margin-bottom: 30px;">
									<div style="display: inline-flex; gap: 30px; flex-wrap: wrap; justify-content: center;">
										<div style="text-align: center;">
											<div style="font-size: 24px; color: #e74c3c; margin-bottom: 5px;">‚≠ê</div>
											<div style="font-size: 14px; color: #666;">Michelin Stars</div>
										</div>
										<div style="text-align: center;">
											<div style="font-size: 24px; color: #3498db; margin-bottom: 5px;">üì±</div>
											<div style="font-size: 14px; color: #666;">AI Analysis</div>
										</div>
										<div style="text-align: center;">
											<div style="font-size: 24px; color: #27ae60; margin-bottom: 5px;">üåê</div>
											<div style="font-size: 14px; color: #666;">Global Coverage</div>
										</div>
										<div style="text-align: center;">
											<div style="font-size: 24px; color: #f39c12; margin-bottom: 5px;">üìä</div>
											<div style="font-size: 14px; color: #666;">Smart Insights</div>
										</div>
									</div>
								</div>
								<p style="font-size: 18px; letter-spacing: 1px; color: #505050; text-align:center;">
									Explore restaurants from every timezone, translated and analyzed by AI</p>
							</div>
						</div>
						<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 ">
							<div class="main-search fancy bg-holder">
								<form id="restaurant-search-form" action="{% url 'restaurants:restaurant_list' %}" method="GET">
									<div class="row">
										<div class="col-lg-8 col-md-8 col-sm-7 col-xs-12">
											<div class="field-holder">
												<input type="text" name="search" id="restaurant-query" placeholder="Search restaurants, cuisine, or enter a location (e.g., 'French restaurants in Paris' or 'New York, NY')" autocomplete="off">
												<div id="search-suggestions" class="search-suggestions" style="display: none;"></div>
											</div>
										</div>
										<div class="col-lg-4 col-md-4 col-sm-5 col-xs-12">
											<div class="field-holder">
												<div style="display: flex; gap: 10px;">
													<button type="button" id="use-location-btn" class="btn btn-outline-primary" style="white-space: nowrap; padding: 8px 12px;">
														<i class="icon-target5"></i> Use My Location
													</button>
													<input type="submit" value="Search" style="flex: 1;">
												</div>
											</div>
										</div>
									</div>
									<!-- Search results container for enhanced messaging -->
									<div id="search-results-message" class="search-results-message" style="display: none; margin-top: 15px; padding: 10px; border-radius: 5px; background: #f8f9fa; border-left: 4px solid #17a2b8;">
										<p id="search-message-text" style="margin: 0; color: #333;"></p>
									</div>
								</form>
							</div>
						</div>
						
					</div>
				</div>
			</div>
			<!-- Main Search End -->
			
			<!-- LLM Chatbot Engagement -->
			<div class="page-section nopadding cs-nomargin" style="padding: 40px 0; background: linear-gradient(135deg, #e74c3c 0%, #ffd700 100%);">
				<div class="container">
					<div class="row">
						<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
							<div style="text-align: center; color: white;">
								<h3 style="color: white; margin-bottom: 15px; font-size: 28px;">
									<i class="icon-comments" style="margin-right: 10px;"></i>
									Your Personal Dining Assistant
								</h3>
								<p style="font-size: 20px; margin-bottom: 25px; line-height: 1.6;">
									I can help you find your new favorite restaurant! Ask me about cuisines, locations, dietary preferences, or special occasions.
								</p>
								<button onclick="startRestaurantDiscoveryChat()" style="background: rgba(255,255,255,0.2); border: 3px solid white; color: white; padding: 15px 30px; border-radius: 30px; font-size: 18px; cursor: pointer; transition: all 0.3s ease; font-weight: 600;">
									üçΩÔ∏è Start Restaurant Discovery
								</button>
								<p style="margin-top: 15px; font-size: 14px; opacity: 0.9;">
									Ask me anything: "I want romantic French dining in Paris" or "Vegan options near me"
								</p>
							</div>
						</div>
					</div>
				</div>
			</div>
			
			<!-- Top Restarurants Section Start -->
			<div class="page-section nopadding cs-nomargin" style="margin-top: 0px;padding-top: 60px;padding-bottom: 0px;margin-bottom: 0px;background: #ffffff;">
				<div class="container">
					<div class="row">
						<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
							<div class="element-title align-center">
								<h2>Top Michelin-Starred Restaurants</h2>
								<p>Discover the world's finest dining establishments with exceptional ratings</p>
							</div>
						</div>
						<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
							<div class="row">
								{% for restaurant in top_restaurants %}
								<div class="col-lg-4 col-md-6 col-sm-6 col-xs-12" style="margin-bottom: 30px;">
									<div class="restaurant-card" style="background: #fff; border: 1px solid #eee; border-radius: 8px; overflow: hidden; transition: all 0.3s ease; box-shadow: 0 2px 10px rgba(0,0,0,0.1); height: 100%;">
										{% if restaurant.images.all %}
											{% if restaurant.images.count == 1 %}
												<!-- Single image -->
												<div class="restaurant-image" style="height: 200px; overflow: hidden; position: relative;">
													{% with restaurant.images.first as image %}
														{% if image.source_url %}
															<img src="{{ image.source_url }}" style="width: 100%; height: 100%; object-fit: cover;" alt="{{ restaurant.name }}" onerror="this.parentElement.innerHTML='<div class=\'star-placeholder\'><i class=\'icon-knife-fork\'></i></div>'">
														{% elif image.image %}
															<img src="{{ image.image.url }}" style="width: 100%; height: 100%; object-fit: cover;" alt="{{ restaurant.name }}" onerror="this.parentElement.innerHTML='<div class=\'star-placeholder\'><i class=\'icon-knife-fork\'></i></div>'">
														{% endif %}
													{% endwith %}
													<div class="michelin-star-badge">
														<span class="michelin-stars">
															{% for i in "123" %}
																{% if forloop.counter <= restaurant.michelin_stars %}‚≠ê{% endif %}
															{% endfor %}
														</span>
														{{ restaurant.michelin_stars }} Star{{ restaurant.michelin_stars|pluralize }}
													</div>
												</div>
											{% else %}
												<!-- Multiple images - carousel -->
												<div class="home-image-carousel" data-restaurant-id="top-{{ restaurant.id }}">
													<div class="home-carousel-track" id="top-carousel-{{ restaurant.id }}">
														{% for image in restaurant.images.all|slice:":5" %}
															{% if image.source_url %}
																<img src="{{ image.source_url }}" alt="{{ restaurant.name }}" onerror="this.style.display='none'">
															{% elif image.image %}
																<img src="{{ image.image.url }}" alt="{{ restaurant.name }}" onerror="this.style.display='none'">
															{% endif %}
														{% endfor %}
													</div>
													
													<!-- Navigation controls -->
													<button class="home-carousel-controls prev" onclick="homeCarouselPrev('top-{{ restaurant.id }}')">‚Äπ</button>
													<button class="home-carousel-controls next" onclick="homeCarouselNext('top-{{ restaurant.id }}')">‚Ä∫</button>
													
													<!-- Dots navigation -->
													<div class="home-carousel-nav">
														{% for image in restaurant.images.all|slice:":5" %}
															<div class="home-carousel-dot {% if forloop.first %}active{% endif %}" 
																 onclick="homeCarouselGoTo('top-{{ restaurant.id }}', {{ forloop.counter0 }})"></div>
														{% endfor %}
													</div>
													
													<!-- Michelin star badge -->
													<div class="michelin-star-badge">
														<span class="michelin-stars">
															{% for i in "123" %}
																{% if forloop.counter <= restaurant.michelin_stars %}‚≠ê{% endif %}
															{% endfor %}
														</span>
														{{ restaurant.michelin_stars }} Star{{ restaurant.michelin_stars|pluralize }}
													</div>
												</div>
											{% endif %}
										{% else %}
											<div class="star-placeholder">
												<i class="icon-knife-fork"></i>
											</div>
										{% endif %}
										<div style="padding: 20px; display: flex; flex-direction: column; justify-content: space-between; flex-grow: 1;">
											<div>
												<h4 style="margin: 0 0 10px 0; font-size: 18px; color: #333;"><a href="{% url 'restaurants:restaurant_detail' restaurant.pk %}" style="text-decoration: none; color: inherit;">{{ restaurant.name }}</a></h4>
												<p style="margin: 0 0 10px 0; color: #666; font-size: 14px;">{{ restaurant.city }}, {{ restaurant.country }}</p>
												<p style="margin: 0 0 15px 0; color: #666; font-size: 13px;">{{ restaurant.cuisine_type|default:"Fine Dining" }}</p>
											</div>
											<div style="display: flex; justify-content: space-between; align-items: center;">
												<span class="customer-rating" style="font-weight: bold;">‚òÖ {{ restaurant.rating|floatformat:1 }}</span>
												<a href="{% url 'restaurants:restaurant_detail' restaurant.pk %}" class="btn btn-sm" style="background: #e74c3c; color: white; text-decoration: none; padding: 5px 15px; border-radius: 20px; font-size: 12px;">View Details</a>
											</div>
										</div>
									</div>
								</div>
								{% empty %}
								<div class="col-lg-12">
									<p style="text-align: center; color: #666; font-style: italic;">Loading top restaurants...</p>
								</div>
								{% endfor %}
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- Top Restarurants Section End -->
			
			<!-- Recommendations Section Start -->
			<div class="page-section nopadding cs-nomargin" style="margin-top: 0px;padding-top: 60px;padding-bottom: 50px;margin-bottom: 0px;background: #f8f9fa;">
				<div class="container">
					<div class="row">
						<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
							<div class="element-title align-center">
								<h2>Recommended For You</h2>
								<p>Discover restaurants tailored to your taste</p>
							</div>
						</div>
						<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
							<div id="recommendations-container" class="listing fancy">
								<div class="recommendations-loading" style="text-align: center; padding: 40px;">
									<p>Loading personalized recommendations...</p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- Recommendations Section End -->
			
			<!-- Featured Restaurant Images Section Start -->
			<div class="page-section nopadding cs-nomargin" style="margin-top: 0px;padding-top: 60px;padding-bottom: 50px;margin-bottom: 0px;background: #f8f9fa;">
				<div class="container">
					<div class="row">
						<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
							<div class="element-title align-center">
								<h2>Visual Journey: Exceptional Dining Experiences</h2>
								<p>Explore the ambiance and elegance of world-class restaurants through AI-curated imagery</p>
							</div>
						</div>
						<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
							<div class="row">
								{% for image in visual_showcase %}
								<div class="col-lg-3 col-md-4 col-sm-6 col-xs-12" style="margin-bottom: 30px;">
									<div class="image-showcase-card" style="background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transition: transform 0.3s ease, box-shadow 0.3s ease; position: relative;">
										<div class="image-container" style="height: 250px; overflow: hidden; position: relative;">
											<img src="{{ image.image_file.url }}" style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease;" alt="{{ image.restaurant.name }}" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
											<div style="position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.8); color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px;">
												AI Confidence: {{ image.category_confidence|floatformat:2 }}
											</div>
											{% if image.restaurant.michelin_stars %}
											<div style="position: absolute; top: 10px; right: 10px; background: #e74c3c; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px;">
												{% for i in "123"|slice:":image.restaurant.michelin_stars" %}‚òÖ{% endfor %}
											</div>
											{% endif %}
											<div style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.7)); padding: 20px 15px 15px; color: white;">
												<h5 style="margin: 0; font-size: 16px; font-weight: 600;"><a href="{% url 'restaurants:restaurant_detail' image.restaurant.pk %}" style="color: white; text-decoration: none;">{{ image.restaurant.name }}</a></h5>
												<p style="margin: 5px 0 0 0; font-size: 13px; opacity: 0.9;">{{ image.restaurant.city }}, {{ image.restaurant.country }}</p>
											</div>
										</div>
									</div>
								</div>
								{% empty %}
								<div class="col-lg-12">
									<p style="text-align: center; color: #666; font-style: italic;">Loading featured restaurant images...</p>
								</div>
								{% endfor %}
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- Featured Restaurant Images Section End -->
			
			<!-- Choose From Most Popular Listin Start -->
			<div class="page-section nopadding cs-nomargin" style="margin-top: 0px;padding-top: 60px;padding-bottom: 50px;margin-bottom: 0px;background: #ffffff;">
				<div class="container">
					<div class="row">
						<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
							<div class="element-title align-center">
								<h2>Choose From Most Popular Restaurants</h2>
								<p>Cum doctus civibus efficiantur in imperdiet deterruisset.</p>
							</div>
						</div>
						<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
							<div class="listing fancy">
								<ul class="row">
									<li class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
										<div class="list-post featured">
											<div class="img-holder">
												<figure><a href="#"><div class="star-placeholder"><i class="icon-star-full"></i></div></a></figure>
												<span class="restaurant-status close">
													<em class="bookmarkRibbon"></em>Close
												</span>
											</div>
											<div class="text-holder">
												<div class="list-rating">
													<div class="rating-star">
														<span class="rating-box" style="width: 100%;"></span>
													</div>
													<span class="reviews">(1)</span>
												</div>
												<div class="post-title">
													<h5>
														<a href="listing-detail.html">Restaurant Demo</a>
														<span class="sponsored text-color">Sponsored</span>
													</h5>
												</div>
												<address> <span>Type of food : </span> Apple Juice</address>
											</div>
											
										</div>
									</li>
									
									
									
									
									<li class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
										<div class="list-post featured">
											<div class="img-holder">
												<figure><a href="#"><div style="width: 100px; height: 100px; background: linear-gradient(135deg, #e74c3c, #c0392b); display: flex; align-items: center; justify-content: center; border-radius: 8px;"><span style="color: white; font-size: 36px;">‚≠ê</span></div></a></figure>
												<span class="restaurant-status open">
													<em class="bookmarkRibbon"></em>open
												</span>
											</div>
											<div class="text-holder">
												<div class="list-rating">
													<div class="rating-star">
														<span class="rating-box" style="width: 100%;"></span>
													</div>
													<span class="reviews">(1)</span>
												</div>
												<div class="post-title">
													<h5>
														<a href="listing-detail.html">Classic Restaurant</a>
														<span class="sponsored text-color">Sponsored</span>
													</h5>
												</div>
												<address> <span>Type of food : </span> Chicken Roast, Chines
													Soup, Cold
													Coffee, Cold Drink, Hot Dogs</address>
											</div>
											
										</div>
									</li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- Choose From Most Popular Listing End -->

			<!-- Home Pages Elements End  -->
		</div>
		<!-- Main Section End -->
		<!-- Footer Start -->
		<footer id="footer" class="footer-style-2">
			<div class="footer-widget">
				<div class="container">
					<div class="row">
						<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
							<div class="widget widget-newsletter">
								<div class="widget-title">
									<h5>Subscribe to our Newsletter</h5>
								</div>
								<div class="fieldset">
									<form action="#">
										<div class="field-holder">
											<label>
												<i class=" icon-envelope3"></i>
												<input type="text" class="field-input" placeholder=" Enter Your Email Address...">
											</label>
										</div>
										<div class="field-holder btn-holder">
											<input class="subscribe-btn bgcolor" type="submit" value="Sign Up">
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="copyright-sec">
				<div class="container">
					<div class="row">
						<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
							<div class="copyright-inner">
								<div class="copy-right">
									<p>¬© 2020 Foodbakery. All Rights Reserved. Developed By <a href="#">Rathan Kumar</a>
									</p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div> <!-- /.cs-copyright -->
		</footer>
		<!-- Footer End -->
	</div>
	
	<!-- Modal Popup End -->
	<script src="{% static 'js/scripts.js' %}"></script>
	<script src="{% static 'js/functions.js' %}"></script>
	
	<!-- Restaurant Search and Recommendations -->
	<style>
		.search-suggestions {
			position: absolute;
			top: 100%;
			left: 0;
			right: 0;
			background: white;
			border: 1px solid #ddd;
			border-radius: 5px;
			max-height: 300px;
			overflow-y: auto;
			z-index: 1000;
			box-shadow: 0 4px 6px rgba(0,0,0,0.1);
		}
		
		.suggestion-item {
			padding: 12px 15px;
			border-bottom: 1px solid #eee;
			cursor: pointer;
			display: flex;
			align-items: center;
		}
		
		.suggestion-item:hover {
			background-color: #f8f9fa;
		}
		
		.suggestion-item:last-child {
			border-bottom: none;
		}
		
		.suggestion-image {
			width: 50px;
			height: 50px;
			border-radius: 5px;
			object-fit: cover;
			margin-right: 12px;
		}
		
		.suggestion-content {
			flex: 1;
		}
		
		.suggestion-name {
			font-weight: 600;
			color: #333;
			margin: 0 0 4px 0;
		}
		
		.suggestion-details {
			font-size: 12px;
			color: #666;
			margin: 0;
		}
		
		.recommendation-card {
			background: white;
			border-radius: 10px;
			overflow: hidden;
			box-shadow: 0 2px 8px rgba(0,0,0,0.1);
			margin-bottom: 20px;
			transition: transform 0.3s ease, box-shadow 0.3s ease;
		}
		
		.recommendation-card:hover {
			transform: translateY(-5px);
			box-shadow: 0 4px 15px rgba(0,0,0,0.15);
		}
		
		.recommendation-image {
			width: 100%;
			height: 200px;
			object-fit: cover;
		}
		
		.recommendation-content {
			padding: 15px;
		}
		
		.recommendation-name {
			font-size: 18px;
			font-weight: 600;
			margin: 0 0 8px 0;
			color: #333;
		}
		
		.recommendation-location {
			color: #666;
			font-size: 14px;
			margin: 0 0 8px 0;
		}
		
		.recommendation-stars {
			color: #ffa500;
			margin: 0 0 8px 0;
		}
		
		.recommendation-reasons {
			font-size: 12px;
			color: #888;
			margin: 0;
		}
		
		.restaurant-card-placeholder {
			background: #f8f9fa;
			border-radius: 10px;
			padding: 20px;
			text-align: center;
			color: #666;
		}
	</style>
	
	<script>
		// Enhanced search functionality with geolocation
		document.addEventListener('DOMContentLoaded', function() {
			const searchInput = document.getElementById('restaurant-query');
			const suggestionsContainer = document.getElementById('search-suggestions');
			const useLocationBtn = document.getElementById('use-location-btn');
			const searchForm = document.getElementById('restaurant-search-form');
			const searchMessage = document.getElementById('search-results-message');
			const searchMessageText = document.getElementById('search-message-text');
			let searchTimeout;
			let userLocation = null;
			
			// Enhanced search with intelligent parsing
			searchInput.addEventListener('input', function() {
				const query = this.value.trim();
				
				clearTimeout(searchTimeout);
				
				if (query.length < 2) {
					suggestionsContainer.style.display = 'none';
					hideSearchMessage();
					return;
				}
				
				searchTimeout = setTimeout(() => {
					// Check if query contains location indicators
					if (isLocationQuery(query)) {
						fetchGeographicSuggestions(query);
					} else {
						fetchSearchSuggestions(query);
					}
				}, 300);
			});
			
			// Use current location button
			useLocationBtn.addEventListener('click', function() {
				if (navigator.geolocation) {
					this.innerHTML = '<i class="icon-spin"></i> Getting Location...';
					this.disabled = true;
					
					navigator.geolocation.getCurrentPosition(
						position => {
							userLocation = {
								lat: position.coords.latitude,
								lng: position.coords.longitude
							};
							
							// Reverse geocode to get address
							reverseGeocode(userLocation.lat, userLocation.lng)
								.then(address => {
									searchInput.value = `Restaurants near ${address}`;
									showSearchMessage(`Using your current location: ${address}`, 'success');
								})
								.catch(() => {
									searchInput.value = `Restaurants near me (${userLocation.lat.toFixed(4)}, ${userLocation.lng.toFixed(4)})`;
									showSearchMessage('Using your current coordinates for search', 'info');
								})
								.finally(() => {
									this.innerHTML = '<i class="icon-target5"></i> Use My Location';
									this.disabled = false;
								});
						},
						error => {
							showSearchMessage('Unable to access your location. Please enter your address manually.', 'warning');
							this.innerHTML = '<i class="icon-target5"></i> Use My Location';
							this.disabled = false;
						}
					);
				} else {
					showSearchMessage('Geolocation is not supported by your browser. Please enter your address manually.', 'warning');
				}
			});
			
			// Enhanced form submission
			searchForm.addEventListener('submit', function(e) {
				const query = searchInput.value.trim();
				
				// If it's a location-based query, use geographic search
				if (isLocationQuery(query) || userLocation) {
					e.preventDefault();
					performGeographicSearch(query);
				}
				// Otherwise, let normal form submission handle it
			});
			
			// Hide suggestions when clicking outside
			document.addEventListener('click', function(e) {
				if (!searchInput.contains(e.target) && !suggestionsContainer.contains(e.target)) {
					suggestionsContainer.style.display = 'none';
				}
			});
			
			function isLocationQuery(query) {
				const locationIndicators = [
					'near', 'in', 'around', 'close to', 'restaurants in', 'dining in',
					'food near', 'michelin near', 'starred restaurants in'
				];
				
				const queryLower = query.toLowerCase();
				return locationIndicators.some(indicator => queryLower.includes(indicator)) ||
					   /\b\d{5}\b/.test(query) || // ZIP code
					   /\b[A-Z]{2}\b/.test(query); // State abbreviation
			}
			
			function fetchGeographicSuggestions(query) {
				// Extract location and search terms
				const { location, searchTerm } = parseLocationQuery(query);
				
				const url = `{% url 'restaurants:geographic_search_api' %}?address=${encodeURIComponent(location)}&q=${encodeURIComponent(searchTerm)}&max_results=5`;
				
				fetch(url)
					.then(response => response.json())
					.then(data => {
						if (data.message) {
							showSearchMessage(data.message, data.search_type === 'fallback_nearest_michelin' ? 'info' : 'success');
						}
						
						const results = data.results.length > 0 ? data.results : data.fallback_results;
						displaySearchSuggestions(results, true);
					})
					.catch(error => {
						console.error('Geographic search error:', error);
						showSearchMessage('Search temporarily unavailable. Please try again.', 'error');
						suggestionsContainer.style.display = 'none';
					});
			}
			
			function parseLocationQuery(query) {
				const patterns = [
					/(.+?)\s+(?:in|near|around)\s+(.+)/i,
					/(?:restaurants|dining|food|michelin)\s+(?:in|near|around)\s+(.+)/i,
					/(.+)/i  // fallback - treat entire query as location
				];
				
				for (let pattern of patterns) {
					const match = query.match(pattern);
					if (match) {
						if (match.length === 3) {
							return { searchTerm: match[1].trim(), location: match[2].trim() };
						} else {
							return { searchTerm: '', location: match[1].trim() };
						}
					}
				}
				
				return { searchTerm: '', location: query };
			}
			
			function fetchSearchSuggestions(query) {
				const url = `{% url 'restaurants:restaurant_search_api' %}?q=${encodeURIComponent(query)}&max_results=5`;
				
				fetch(url)
					.then(response => response.json())
					.then(data => {
						displaySearchSuggestions(data.results);
					})
					.catch(error => {
						console.error('Search error:', error);
						suggestionsContainer.style.display = 'none';
					});
			}
			
			function displaySearchSuggestions(results, includeDistance = false) {
				if (results.length === 0) {
					suggestionsContainer.style.display = 'none';
					return;
				}
				
				let html = '';
				results.forEach(restaurant => {
					const imageUrl = restaurant.featured_image?.url || '';
					const stars = '‚≠ê'.repeat(restaurant.michelin_stars || 0);
					const distance = includeDistance && restaurant.distance_km ? 
						` ‚Ä¢ ${restaurant.distance_km}km away` : '';
					
					html += `
						<div class="suggestion-item" onclick="selectRestaurant('${restaurant.url}')">
							${imageUrl ? `<img src="${imageUrl}" alt="${restaurant.name}" class="suggestion-image" onerror="this.parentElement.innerHTML='<div class=\\'star-placeholder-small\\'><i class=\\'icon-star-full\\'></i></div>'">` : `<div class="star-placeholder-small"><i class="icon-star-full"></i></div>`}
							<div class="suggestion-content">
								<h4 class="suggestion-name">${restaurant.name}</h4>
								<p class="suggestion-details">
									${restaurant.city}, ${restaurant.country} ‚Ä¢ ${restaurant.cuisine_type || 'Restaurant'}
									${stars ? ' ‚Ä¢ ' + stars : ''}${distance}
								</p>
							</div>
						</div>
					`;
				});
				
				suggestionsContainer.innerHTML = html;
				suggestionsContainer.style.display = 'block';
			}
			
			function performGeographicSearch(query) {
				const { location, searchTerm } = parseLocationQuery(query);
				
				// Redirect to restaurant list with geographic search parameters
				let url = "{% url 'restaurants:restaurant_list' %}";
				const params = new URLSearchParams();
				
				if (searchTerm) params.append('search', searchTerm);
				if (location) params.append('location', location);
				
				if (params.toString()) {
					url += '?' + params.toString();
				}
				
				window.location.href = url;
			}
			
			function reverseGeocode(lat, lng) {
				return new Promise((resolve, reject) => {
					// You can implement Google Maps reverse geocoding here
					// For now, return a simple format
					resolve(`${lat.toFixed(4)}, ${lng.toFixed(4)}`);
				});
			}
			
			function showSearchMessage(message, type = 'info') {
				searchMessageText.textContent = message;
				
				// Reset classes
				searchMessage.className = 'search-results-message';
				
				// Add type-specific styling
				switch(type) {
					case 'success':
						searchMessage.style.borderLeftColor = '#28a745';
						searchMessage.style.backgroundColor = '#d4edda';
						break;
					case 'warning':
						searchMessage.style.borderLeftColor = '#ffc107';
						searchMessage.style.backgroundColor = '#fff3cd';
						break;
					case 'error':
						searchMessage.style.borderLeftColor = '#dc3545';
						searchMessage.style.backgroundColor = '#f8d7da';
						break;
					default:
						searchMessage.style.borderLeftColor = '#17a2b8';
						searchMessage.style.backgroundColor = '#f8f9fa';
				}
				
				searchMessage.style.display = 'block';
				
				// Auto-hide after 5 seconds for non-error messages
				if (type !== 'error') {
					setTimeout(hideSearchMessage, 5000);
				}
			}
			
			function hideSearchMessage() {
				searchMessage.style.display = 'none';
			}
			
			// Load recommendations
			loadRecommendations();
		});
		
		function selectRestaurant(url) {
			window.location.href = url;
		}
		
		function loadRecommendations() {
			const container = document.getElementById('recommendations-container');
			const isAuthenticated = {{ user.is_authenticated|yesno:"true,false" }};
			
			// Use enhanced personalized recommendations for authenticated users
			const apiUrl = isAuthenticated 
				? '{% url "restaurants:personalized_recommendations_api" %}?max_results=6'
				: '{% url "restaurants:restaurant_recommendations_api" %}?max_results=6';
			
			fetch(apiUrl)
				.then(response => response.json())
				.then(data => {
					displayRecommendations(data.recommendations, data.recommendation_type);
				})
				.catch(error => {
					console.error('Recommendations error:', error);
					container.innerHTML = `
						<div class="restaurant-card-placeholder">
							<p>Unable to load recommendations at this time.</p>
						</div>
					`;
				});
		}
		
		function displayRecommendations(recommendations, recommendationType) {
			const container = document.getElementById('recommendations-container');
			
			if (recommendations.length === 0) {
				container.innerHTML = `
					<div class="restaurant-card-placeholder">
						<p>No recommendations available. Try adding some restaurant reviews to get personalized suggestions!</p>
					</div>
				`;
				return;
			}
			
			let html = '<ul class="row">';
			
			recommendations.forEach(rec => {
				const restaurant = rec;
				const imageUrl = restaurant.featured_image?.url || '';
				// Michelin stars (red) and customer rating (yellow) 
				const michelinStars = restaurant.michelin_stars ? 
					`<span class="michelin-stars">${'‚≠ê'.repeat(restaurant.michelin_stars)}</span> ${restaurant.michelin_stars} Star${restaurant.michelin_stars > 1 ? 's' : ''}` : '';
				const customerRating = restaurant.rating ? 
					`<span class="customer-rating">‚òÖ ${restaurant.rating.toFixed(1)}/5</span>` : '';
				
				// Enhanced recommendation display with collaborative filtering info
				let reasons = '';
				let scoreDisplay = '';
				
				if (recommendationType === 'enhanced_personalized') {
					// Show collaborative filtering explanation and score breakdown
					reasons = restaurant.explanation || 'Recommended based on your preferences';
					const totalScore = Math.round((restaurant.total_score || 0) * 100);
					scoreDisplay = `
						<div style="background: rgba(231, 76, 60, 0.1); padding: 8px; border-radius: 6px; margin: 5px 0; font-size: 11px;">
							<strong>Match Score: ${totalScore}%</strong>
							${restaurant.similar_users_count > 0 ? `<br>üìä ${restaurant.similar_users_count} similar users liked this` : ''}
						</div>
					`;
				} else {
					// Fallback for anonymous users
					reasons = restaurant.reasons?.slice(0, 2).join(', ') || 'Popular choice';
				}
				
				// Generate carousel or single image
				let imageHtml = '';
				if (restaurant.images && restaurant.images.length > 1) {
					// Multiple images - carousel
					const carouselId = `rec-${restaurant.id || Math.random().toString(36).substr(2, 9)}`;
					imageHtml = `
						<div class="home-image-carousel" data-restaurant-id="${carouselId}">
							<div class="home-carousel-track" id="rec-carousel-${carouselId}">
								${restaurant.images.slice(0, 5).map(img => 
									`<img src="${img.url}" alt="${restaurant.name}" onerror="this.style.display='none'">`
								).join('')}
							</div>
							<button class="home-carousel-controls prev" onclick="homeCarouselPrev('${carouselId}')">‚Äπ</button>
							<button class="home-carousel-controls next" onclick="homeCarouselNext('${carouselId}')">‚Ä∫</button>
							<div class="home-carousel-nav">
								${restaurant.images.slice(0, 5).map((_, index) => 
									`<div class="home-carousel-dot ${index === 0 ? 'active' : ''}" onclick="homeCarouselGoTo('${carouselId}', ${index})"></div>`
								).join('')}
							</div>
						</div>
					`;
				} else if (imageUrl) {
					// Single image
					imageHtml = `<img src="${imageUrl}" alt="${restaurant.name}" class="recommendation-image" onerror="this.parentElement.innerHTML='<div class=\\'star-placeholder-small\\'><i class=\\'icon-star-full\\'></i></div>'">`;
				} else {
					// No image fallback
					imageHtml = `<div class="star-placeholder-small"><i class="icon-knife-fork"></i></div>`;
				}
				
				html += `
					<li class="col-lg-4 col-md-6 col-sm-6 col-xs-12">
						<div class="recommendation-card">
							${imageHtml}
							<div class="recommendation-content">
								<h3 class="recommendation-name">
									<a href="${restaurant.url}" style="color: inherit; text-decoration: none;">
										${restaurant.name}
									</a>
								</h3>
								<p class="recommendation-location">
									${restaurant.city}, ${restaurant.country}
								</p>
								<div class="recommendation-stars">
									${michelinStars}
									${michelinStars && customerRating ? '<br>' : ''}
									${customerRating}
								</div>
								<p class="recommendation-reasons">
									${reasons}
								</p>
								${scoreDisplay}
							</div>
						</div>
					</li>
				`;
			});
			
			html += '</ul>';
			container.innerHTML = html;
		}
		
		// LLM Chatbot engagement for restaurant discovery
		function startRestaurantDiscoveryChat() {
			// Navigate to chat page with pre-filled message
			const chatUrl = '/chat/';
			const message = encodeURIComponent("I'm looking for a new restaurant to try! Can you help me find something based on my preferences?");
			
			// Store the pre-filled message in localStorage for the chat page to use
			localStorage.setItem('chatPrefilledMessage', "I'm looking for a new restaurant to try! Can you help me find something based on my preferences?");
			
			// Navigate to chat page
			window.location.href = chatUrl;
		}
		
		// Home Page Carousel Management
		const homeCarouselStates = {};
		
		function initializeHomeCarousel(carouselId) {
			if (!homeCarouselStates[carouselId]) {
				const track = document.getElementById(`top-carousel-${carouselId}`) || document.getElementById(`rec-carousel-${carouselId}`);
				const images = track ? track.querySelectorAll('img') : [];
				homeCarouselStates[carouselId] = {
					currentIndex: 0,
					totalImages: images.length
				};
			}
		}
		
		function updateHomeCarousel(carouselId) {
			const track = document.getElementById(`top-carousel-${carouselId}`) || document.getElementById(`rec-carousel-${carouselId}`);
			const dots = document.querySelectorAll(`[data-restaurant-id="${carouselId}"] .home-carousel-dot`);
			
			if (!track || !homeCarouselStates[carouselId]) return;
			
			const state = homeCarouselStates[carouselId];
			const translateX = -state.currentIndex * 100;
			track.style.transform = `translateX(${translateX}%)`;
			
			// Update dots
			dots.forEach((dot, index) => {
				dot.classList.toggle('active', index === state.currentIndex);
			});
		}
		
		function homeCarouselPrev(carouselId) {
			initializeHomeCarousel(carouselId);
			const state = homeCarouselStates[carouselId];
			
			if (state.currentIndex > 0) {
				state.currentIndex--;
			} else {
				state.currentIndex = state.totalImages - 1; // Loop to last image
			}
			
			updateHomeCarousel(carouselId);
		}
		
		function homeCarouselNext(carouselId) {
			initializeHomeCarousel(carouselId);
			const state = homeCarouselStates[carouselId];
			
			if (state.currentIndex < state.totalImages - 1) {
				state.currentIndex++;
			} else {
				state.currentIndex = 0; // Loop to first image
			}
			
			updateHomeCarousel(carouselId);
		}
		
		function homeCarouselGoTo(carouselId, index) {
			initializeHomeCarousel(carouselId);
			const state = homeCarouselStates[carouselId];
			
			if (index >= 0 && index < state.totalImages) {
				state.currentIndex = index;
				updateHomeCarousel(carouselId);
			}
		}
		
		// Initialize all home carousels when page loads
		document.addEventListener('DOMContentLoaded', function() {
			const carousels = document.querySelectorAll('.home-image-carousel');
			carousels.forEach(carousel => {
				const carouselId = carousel.getAttribute('data-restaurant-id');
				if (carouselId) {
					initializeHomeCarousel(carouselId);
					updateHomeCarousel(carouselId);
				}
			});
		});
	</script>
</body>

</html>