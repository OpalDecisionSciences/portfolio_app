{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>{{ restaurant.name }} - FoodOnline</title>
	<!-- Google Font Family Link Start -->
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Montserrat:400,700">
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,800">
	<!-- Google Font Family Link End -->

	<!-- CSS -->
	<link href="{% static 'css/iconmoon.css' %}" rel="stylesheet">
	<link href="{% static 'css/style.css' %}" rel="stylesheet">
	<link href="{% static 'css/cs-foodbakery-plugin.css' %}" rel="stylesheet">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
	<link href="{% static 'css/bootstrap-slider.css' %}" rel="stylesheet">
	
	<!-- JAVASCRIPT -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script src="{% static 'js/modernizr.js' %}"></script>
	<script src="{% static 'js/bootstrap.js' %}"></script>

	<style>
		body, .main-section p, .mce-content-body p{
			font:Normal  14px/24px "Open Sans", sans-serif;letter-spacing: 0px;text-transform: none;color: #515151 !important;
		}
		
		.restaurant-hero {
			position: relative;
			height: 400px;
			overflow: hidden;
			border-radius: 10px;
			margin-bottom: 30px;
		}
		
		.restaurant-hero img {
			width: 100%;
			height: 100%;
			object-fit: cover;
		}
		
		.restaurant-hero-fallback {
			width: 100%;
			height: 100%;
			background: linear-gradient(45deg, #f8f9fa, #e9ecef);
			display: flex;
			align-items: center;
			justify-content: center;
			color: #6c757d;
			font-size: 64px;
		}
		
		.restaurant-info-card {
			background: white;
			padding: 30px;
			border-radius: 10px;
			box-shadow: 0 2px 10px rgba(0,0,0,0.1);
			margin-bottom: 30px;
		}
		
		.restaurant-name {
			font-size: 36px;
			font-weight: 700;
			color: #2c3e50;
			margin-bottom: 15px;
		}
		
		.restaurant-location {
			color: #7f8c8d;
			font-size: 18px;
			margin-bottom: 15px;
		}
		
		.restaurant-stats {
			display: flex;
			align-items: center;
			gap: 20px;
			margin-bottom: 20px;
			flex-wrap: wrap;
		}
		
		.stat-item {
			display: flex;
			align-items: center;
			gap: 5px;
		}
		
		.michelin-stars {
			color: #e74c3c;
			font-size: 20px;
		}
		
		.rating-stars {
			color: #f39c12;
		}
		
		.price-range {
			color: #27ae60;
			font-weight: 600;
		}
		
		.image-gallery {
			margin: 30px 0;
		}
		
		.gallery-section h3 {
			color: #2c3e50;
			margin-bottom: 20px;
		}
		
		.image-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
			gap: 15px;
			margin-bottom: 30px;
		}
		
		.gallery-image {
			width: 100%;
			height: 200px;
			object-fit: cover;
			border-radius: 8px;
			cursor: pointer;
			transition: transform 0.3s ease;
		}
		
		.gallery-image:hover {
			transform: scale(1.05);
		}
		
		.recommendations-section {
			margin-top: 50px;
			padding-top: 30px;
			border-top: 1px solid #eee;
		}
		
		.recommendation-card {
			background: white;
			border-radius: 10px;
			overflow: hidden;
			box-shadow: 0 2px 8px rgba(0,0,0,0.1);
			margin-bottom: 20px;
			transition: transform 0.3s ease;
		}
		
		.recommendation-card:hover {
			transform: translateY(-5px);
		}
		
		.recommendation-image {
			width: 100%;
			height: 150px;
			object-fit: cover;
		}
		
		.recommendation-content {
			padding: 15px;
		}
		
		.recommendation-name {
			font-size: 16px;
			font-weight: 600;
			margin-bottom: 5px;
		}
		
		.recommendation-location {
			color: #666;
			font-size: 14px;
			margin-bottom: 5px;
		}
		
		.recommendation-stars {
			color: #ffa500;
		}
		
		/* Modal for image viewing */
		.image-modal {
			display: none;
			position: fixed;
			z-index: 1000;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0,0,0,0.9);
		}
		
		.modal-content {
			margin: auto;
			display: block;
			width: 80%;
			max-width: 700px;
			max-height: 80%;
			margin-top: 5%;
		}
		
		.close {
			position: absolute;
			top: 15px;
			right: 35px;
			color: #f1f1f1;
			font-size: 40px;
			font-weight: bold;
			cursor: pointer;
		}
		
		.close:hover {
			color: #bbb;
		}
		
		/* Restaurant About Section Styles */
		.restaurant-about-content {
			line-height: 1.8;
			color: #444;
		}
		
		.restaurant-about-content h2 {
			color: #2c3e50;
			margin-top: 25px;
			margin-bottom: 15px;
			font-size: 20px;
		}
		
		.restaurant-about-content h3 {
			color: #34495e;
			margin-top: 20px;
			margin-bottom: 10px;
			font-size: 16px;
		}
		
		/* Menu Section Styles */
		.menu-section {
			margin-bottom: 40px;
			border-bottom: 1px solid #eee;
			padding-bottom: 30px;
		}
		
		.menu-section:last-child {
			border-bottom: none;
		}
		
		.menu-section-title {
			color: #2c3e50;
			font-size: 24px;
			margin-bottom: 10px;
			border-bottom: 2px solid #3498db;
			padding-bottom: 5px;
		}
		
		.menu-section-description {
			color: #666;
			font-style: italic;
			margin-bottom: 20px;
		}
		
		.menu-items {
			display: grid;
			gap: 15px;
		}
		
		.menu-item {
			padding: 15px;
			background: #f8f9fa;
			border-radius: 8px;
			border-left: 4px solid #3498db;
		}
		
		.menu-item-header {
			display: flex;
			justify-content: space-between;
			align-items: flex-start;
			margin-bottom: 8px;
		}
		
		.menu-item-name {
			color: #2c3e50;
			font-size: 18px;
			font-weight: 600;
			margin: 0;
			flex: 1;
		}
		
		.menu-item-price {
			color: #27ae60;
			font-weight: 700;
			font-size: 16px;
			white-space: nowrap;
			margin-left: 15px;
		}
		
		.menu-item-description {
			color: #666;
			margin: 0;
			line-height: 1.6;
		}
		
		/* Timezone and metadata styles */
		.restaurant-metadata {
			background: #f8f9fa;
			padding: 15px;
			border-radius: 8px;
			margin-top: 20px;
			font-size: 14px;
			color: #666;
		}
		
		.restaurant-metadata h4 {
			color: #2c3e50;
			font-size: 16px;
			margin-bottom: 10px;
		}
		
		.timezone-info {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
			gap: 10px;
		}
		
		.timezone-item {
			display: flex;
			justify-content: space-between;
		}
		
		.timezone-label {
			font-weight: 600;
		}
	</style>
</head>

<body>
	<!--Main Wrapper-->
	<div class="wrapper">
		<!-- Header Start -->
		<header id="header">
			<div class="main-header">
				<div class="container">
					<div class="row">
						<div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
							<div class="logo">
								<figure>
									<a href="{% url 'home' %}" class="light-logo">
										<img src="{% static 'logo/foodOnlineLogo.png' %}" alt="FoodOnline" width="250">
									</a>
								</figure>
							</div>
							<div class="main-nav">
								<nav id="site-navigation" class="main-navigation">
									<ul>
										<li><a href="{% url 'home' %}">Home</a></li>
										<li><a href="{% url 'restaurants:restaurant_list' %}">Restaurants</a></li>
										<li><a href="{% url 'restaurants:gallery' %}">Gallery</a></li>
									</ul>
								</nav>
							</div>
						</div>
						<div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
							<div class="login-option">
								<a class="cs-color cs-popup-joinus-btn login-popup" href="#">Login / Register</a>
								<a class="get-start-btn" href="#">Register Restaurant</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</header>
		<!-- Header End -->
		
		<!-- Main Section Start -->
		<div class="main-section">
			<div class="page-section">
				<div class="container">
					<!-- Restaurant Hero Image -->
					<div class="restaurant-hero">
						{% if featured_image %}
							{% if featured_image.source_url %}
								<img src="{{ featured_image.source_url }}" alt="{{ restaurant.name }}" 
									 onerror="this.parentElement.innerHTML='<div class=\'restaurant-hero-fallback\'><i class=\'icon-knife-fork\'></i></div>'">
							{% elif featured_image.image %}
								<img src="{{ featured_image.image.url }}" alt="{{ restaurant.name }}"
									 onerror="this.parentElement.innerHTML='<div class=\'restaurant-hero-fallback\'><i class=\'icon-knife-fork\'></i></div>'">
							{% else %}
								<div class="restaurant-hero-fallback">
									<i class="icon-knife-fork"></i>
								</div>
							{% endif %}
						{% else %}
							<div class="restaurant-hero-fallback">
								<i class="icon-knife-fork"></i>
							</div>
						{% endif %}
					</div>
					
					<div class="row">
						<div class="col-lg-8">
							<!-- Restaurant Information -->
							<div class="restaurant-info-card">
								<h1 class="restaurant-name">{{ restaurant.name }}</h1>
								<p class="restaurant-location">
									<i class="icon-location"></i>
									{{ restaurant.city }}, {{ restaurant.country }}
								</p>
								
								<div class="restaurant-stats">
									{% if restaurant.michelin_stars %}
									<div class="stat-item">
										<span class="michelin-stars">
											{% for i in "123" %}
												{% if forloop.counter <= restaurant.michelin_stars %}⭐{% endif %}
											{% endfor %}
										</span>
										<span>{{ restaurant.michelin_stars }} Michelin Star{{ restaurant.michelin_stars|pluralize }}</span>
									</div>
									{% endif %}
									
									{% if restaurant.rating %}
									<div class="stat-item">
										<span class="rating-stars">
											{% for i in "12345" %}
												{% if forloop.counter <= restaurant.rating %}★{% else %}☆{% endif %}
											{% endfor %}
										</span>
										<span>{{ restaurant.rating }}/5</span>
									</div>
									{% endif %}
									
									{% if restaurant.cuisine_type %}
									<div class="stat-item">
										<i class="icon-cutlery"></i>
										<span>{{ restaurant.cuisine_type }}</span>
									</div>
									{% endif %}
									
									{% if restaurant.price_range %}
									<div class="stat-item">
										<span class="price-range">{{ restaurant.price_range }}</span>
									</div>
									{% endif %}
								</div>
								
								{% if restaurant.description %}
								<div class="restaurant-description">
									<p>{{ restaurant.description }}</p>
								</div>
								{% endif %}
							</div>
							
							<!-- Restaurant About Section (document.txt functionality) -->
							{% if document_content %}
							<div class="restaurant-info-card">
								<h2><i class="icon-info"></i> About {{ restaurant.name }}</h2>
								<div class="restaurant-about-content">
									{{ document_content|linebreaks }}
								</div>
							</div>
							{% endif %}
							
							<!-- Menu Sections -->
							{% if menu_sections %}
							<div class="restaurant-info-card">
								<h2><i class="icon-cutlery"></i> Menu</h2>
								{% for section in menu_sections %}
								<div class="menu-section">
									<h3 class="menu-section-title">{{ section.name }}</h3>
									{% if section.description %}
									<p class="menu-section-description">{{ section.description }}</p>
									{% endif %}
									<div class="menu-items">
										{% for item in section.items.all %}
										<div class="menu-item">
											<div class="menu-item-header">
												<h4 class="menu-item-name">{{ item.name }}</h4>
												{% if item.price %}
												<span class="menu-item-price">{{ item.price }}</span>
												{% endif %}
											</div>
											{% if item.description %}
											<p class="menu-item-description">{{ item.description }}</p>
											{% endif %}
										</div>
										{% endfor %}
									</div>
								</div>
								{% endfor %}
							</div>
							{% endif %}
							
							<!-- Image Gallery -->
							{% if images %}
							<div class="image-gallery">
								<!-- Menu Images -->
								{% if menu_images %}
								<div class="gallery-section">
									<h3><i class="icon-cutlery"></i> Menu & Food</h3>
									<div class="image-grid">
										{% for image in menu_images %}
										<img src="{% if image.source_url %}{{ image.source_url }}{% elif image.image %}{{ image.image.url }}{% endif %}" 
											 alt="{{ image.get_display_name }}" 
											 class="gallery-image"
											 onclick="openModal(this.src)"
											 onerror="this.style.display='none'">
										{% endfor %}
									</div>
								</div>
								{% endif %}
								
								<!-- Ambiance Images -->
								{% if ambiance_images %}
								<div class="gallery-section">
									<h3><i class="icon-home"></i> Ambiance & Interior</h3>
									<div class="image-grid">
										{% for image in ambiance_images %}
										<img src="{% if image.source_url %}{{ image.source_url }}{% elif image.image %}{{ image.image.url }}{% endif %}" 
											 alt="{{ image.get_display_name }}" 
											 class="gallery-image"
											 onclick="openModal(this.src)"
											 onerror="this.style.display='none'">
										{% endfor %}
									</div>
								</div>
								{% endif %}
								
								<!-- All Other Images -->
								{% if images.count > menu_images.count|add:ambiance_images.count %}
								<div class="gallery-section">
									<h3><i class="icon-camera"></i> More Photos</h3>
									<div class="image-grid">
										{% for image in images %}
											{% if image not in menu_images and image not in ambiance_images %}
											<img src="{% if image.source_url %}{{ image.source_url }}{% elif image.image %}{{ image.image.url }}{% endif %}" 
												 alt="{{ image.get_display_name }}" 
												 class="gallery-image"
												 onclick="openModal(this.src)"
												 onerror="this.style.display='none'">
											{% endif %}
										{% endfor %}
									</div>
								</div>
								{% endif %}
							</div>
							{% endif %}
						</div>
						
						<div class="col-lg-4">
							<!-- Restaurant Metadata -->
							{% if restaurant.timezone_info or restaurant.scraped_at %}
							<div class="restaurant-info-card">
								<h3><i class="icon-globe"></i> Restaurant Information</h3>
								
								{% if restaurant.timezone_info %}
								<div class="restaurant-metadata">
									<h4>Location & Time</h4>
									<div class="timezone-info">
										<div class="timezone-item">
											<span class="timezone-label">Local Time:</span>
											<span id="local-time">Loading...</span>
										</div>
										<div class="timezone-item">
											<span class="timezone-label">Timezone:</span>
											<span>{{ restaurant.get_timezone_display }}</span>
										</div>
									</div>
								</div>
								{% endif %}
								
								{% if restaurant.website %}
								<div class="restaurant-metadata">
									<h4>Website</h4>
									<a href="{{ restaurant.website }}" target="_blank" rel="noopener">Visit Website</a>
								</div>
								{% endif %}
								
								{% if restaurant.scraped_at %}
								<div class="restaurant-metadata">
									<h4>Data Updated</h4>
									<small>{{ restaurant.scraped_at|date:"M d, Y" }}</small>
								</div>
								{% endif %}
							</div>
							{% endif %}
							
							<!-- Similar Restaurants -->
							{% if similar_restaurants %}
							<div class="recommendations-section">
								<h3>Similar Restaurants</h3>
								{% for similar in similar_restaurants %}
								<div class="recommendation-card">
									{% with similar.restaurant.images.first as rec_image %}
									{% if rec_image %}
										{% if rec_image.source_url %}
											<img src="{{ rec_image.source_url }}" alt="{{ similar.restaurant.name }}" class="recommendation-image"
												 onerror="this.style.display='none'">
										{% elif rec_image.image %}
											<img src="{{ rec_image.image.url }}" alt="{{ similar.restaurant.name }}" class="recommendation-image"
												 onerror="this.style.display='none'">
										{% endif %}
									{% endif %}
									{% endwith %}
									<div class="recommendation-content">
										<h4 class="recommendation-name">
											<a href="{% url 'restaurants:restaurant_detail' similar.restaurant.slug %}" style="color: inherit; text-decoration: none;">
												{{ similar.restaurant.name }}
											</a>
										</h4>
										<p class="recommendation-location">
											{{ similar.restaurant.city }}, {{ similar.restaurant.country }}
										</p>
										{% if similar.restaurant.michelin_stars %}
										<div class="recommendation-stars">
											{% for i in "123" %}
												{% if forloop.counter <= similar.restaurant.michelin_stars %}⭐{% endif %}
											{% endfor %}
										</div>
										{% endif %}
										{% if similar.similar_features %}
										<small style="color: #888;">
											{{ similar.similar_features|join:", "|truncatewords:3 }}
										</small>
										{% endif %}
									</div>
								</div>
								{% endfor %}
							</div>
							{% endif %}
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- Main Section End -->
		
		<!-- Footer Start -->
		<footer id="footer" class="footer-style-2">
			<div class="footer-widget">
				<div class="container">
					<div class="row">
						<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
							<div class="widget widget-newsletter">
								<div class="widget-title">
									<h5>Subscribe to our Newsletter</h5>
								</div>
								<div class="fieldset">
									<form action="#">
										<div class="field-holder">
											<label>
												<i class="icon-envelope3"></i>
												<input type="text" class="field-input" placeholder="Enter Your Email Address...">
											</label>
										</div>
										<div class="field-holder btn-holder">
											<input class="subscribe-btn bgcolor" type="submit" value="Sign Up">
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="copyright-sec">
				<div class="container">
					<div class="row">
						<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
							<div class="copyright-inner">
								<div class="copy-right">
									<p>© 2020 Foodbakery. All Rights Reserved. Developed By <a href="#">Rathan Kumar</a></p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</footer>
		<!-- Footer End -->
	</div>
	
	<!-- Image Modal -->
	<div id="imageModal" class="image-modal">
		<span class="close">&times;</span>
		<img class="modal-content" id="modalImage">
	</div>
	
	<!-- Scripts -->
	<script src="{% static 'js/scripts.js' %}"></script>
	<script src="{% static 'js/functions.js' %}"></script>
	
	<script>
		// Image modal functionality
		function openModal(src) {
			document.getElementById('imageModal').style.display = 'block';
			document.getElementById('modalImage').src = src;
		}
		
		// Close modal when clicking the close button or outside the image
		document.getElementsByClassName('close')[0].onclick = function() {
			document.getElementById('imageModal').style.display = 'none';
		}
		
		document.getElementById('imageModal').onclick = function(event) {
			if (event.target === this) {
				this.style.display = 'none';
			}
		}
		
		// Close modal with escape key
		document.addEventListener('keydown', function(event) {
			if (event.key === 'Escape') {
				document.getElementById('imageModal').style.display = 'none';
			}
		});
		
		// Timezone functionality
		{% if timezone_info %}
		function updateLocalTime() {
			try {
				const timezone = '{{ timezone_info.local_timezone|escapejs }}';
				const now = new Date();
				const localTime = now.toLocaleString('en-US', {
					timeZone: timezone,
					year: 'numeric',
					month: 'short',
					day: 'numeric',
					hour: '2-digit',
					minute: '2-digit',
					second: '2-digit'
				});
				document.getElementById('local-time').textContent = localTime;
			} catch (error) {
				document.getElementById('local-time').textContent = 'Time unavailable';
			}
		}
		
		// Update time immediately and then every minute
		updateLocalTime();
		setInterval(updateLocalTime, 60000);
		{% endif %}
	</script>
</body>
</html>